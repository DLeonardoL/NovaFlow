{% extends "layout.html" %}

{% block content %}
<div class="dashboard-container">
    <!-- Header -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h3 style="margin: 0; color: #333; font-weight: 600;">Gestión de Proyectos</h3>
    </div>

    <!-- Kanban Board Compacto -->
    <div style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 0.5rem; margin-bottom: 1rem;">
        <!-- Oportunidad -->
        <div style="background: white; border-radius: 4px; padding: 0.4rem; box-shadow: 0 1px 2px rgba(0,0,0,0.08);">
            <div style="color: #00BCD4; font-weight: 600; margin-bottom: 0.1rem; font-size: 0.7rem;">Oportunidad</div>
            <div style="font-size: 1.1rem; font-weight: bold; color: #333;">{{ estados.oportunidad|length }}</div>
        </div>

        <!-- Propuesta -->
        <div style="background: white; border-radius: 4px; padding: 0.4rem; box-shadow: 0 1px 2px rgba(0,0,0,0.08);">
            <div style="color: #666; font-weight: 600; margin-bottom: 0.1rem; font-size: 0.7rem;">Propuesta</div>
            <div style="font-size: 1.1rem; font-weight: bold; color: #333;">{{ estados.propuesta|length }}</div>
        </div>

        <!-- Aprobación -->
        <div style="background: white; border-radius: 4px; padding: 0.4rem; box-shadow: 0 1px 2px rgba(0,0,0,0.08);">
            <div style="color: #FFA726; font-weight: 600; margin-bottom: 0.1rem; font-size: 0.7rem;">Aprobación</div>
            <div style="font-size: 1.1rem; font-weight: bold; color: #333;">{{ estados.aprobacion|length }}</div>
        </div>

        <!-- En Desarrollo -->
        <div style="background: white; border-radius: 4px; padding: 0.4rem; box-shadow: 0 1px 2px rgba(0,0,0,0.08);">
            <div style="color: #66BB6A; font-weight: 600; margin-bottom: 0.1rem; font-size: 0.7rem;">En Desarrollo</div>
            <div style="font-size: 1.1rem; font-weight: bold; color: #333;">{{ estados.desarrollo|length }}</div>
        </div>

        <!-- Testing -->
        <div style="background: white; border-radius: 4px; padding: 0.4rem; box-shadow: 0 1px 2px rgba(0,0,0,0.08);">
            <div style="color: #00BCD4; font-weight: 600; margin-bottom: 0.1rem; font-size: 0.7rem;">Testing</div>
            <div style="font-size: 1.1rem; font-weight: bold; color: #333;">{{ estados.testing|length }}</div>
        </div>

        <!-- Cierre -->
        <div style="background: white; border-radius: 4px; padding: 0.4rem; box-shadow: 0 1px 2px rgba(0,0,0,0.08);">
            <div style="color: #666; font-weight: 600; margin-bottom: 0.1rem; font-size: 0.7rem;">Cierre</div>
            <div style="font-size: 1.1rem; font-weight: bold; color: #333;">{{ estados.cierre|length }}</div>
        </div>

        <!-- Evaluación -->
        <div style="background: white; border-radius: 4px; padding: 0.4rem; box-shadow: 0 1px 2px rgba(0,0,0,0.08);">
            <div style="color: #FFA726; font-weight: 600; margin-bottom: 0.1rem; font-size: 0.7rem;">Evaluación</div>
            <div style="font-size: 1.1rem; font-weight: bold; color: #333;">{{ estados.evaluacion|length }}</div>
        </div>

        <!-- Finalizados -->
        <div style="background: white; border-radius: 4px; padding: 0.4rem; box-shadow: 0 1px 2px rgba(0,0,0,0.08);">
            <div style="color: #66BB6A; font-weight: 600; margin-bottom: 0.1rem; font-size: 0.7rem;">Finalizados</div>
            <div style="font-size: 1.1rem; font-weight: bold; color: #333;">{{ estados.finalizados|length }}</div>
        </div>
    </div>

    <!-- Pipeline de Proyectos Compacto -->
    <div style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem; overflow-x: auto; padding-bottom: 0.5rem;">
        <div style="min-width: 150px; background: #f8f9fa; border-radius: 6px; padding: 0.75rem;">
            <h6 style="margin: 0 0 0.5rem 0; color: #666; font-weight: 600; font-size: 0.8rem;">Oportunidad</h6>
            {% for proyecto in estados.oportunidad %}
                <div style="background: white; border-radius: 4px; padding: 0.5rem; margin-bottom: 0.25rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1); position: relative;">
                    <button onclick="openProyectoModal({{ proyecto.id }}, 'oportunidad')" style="position: absolute; top: 2px; right: 2px; background: none; border: none; padding: 2px; cursor: pointer; opacity: 0.7;" title="Ver detalles">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                    <div style="font-weight: 500; margin-bottom: 0.1rem; font-size: 0.75rem; padding-right: 20px;">{{ proyecto.nombre }}</div>
                    <div style="font-size: 0.65rem; color: #666;">ID: {{ proyecto.id }} | ${{ "{:,.0f}".format(proyecto.monto) }}</div>
                </div>
            {% endfor %}
        </div>
        
        <div style="min-width: 150px; background: #f8f9fa; border-radius: 6px; padding: 0.75rem;">
            <h6 style="margin: 0 0 0.5rem 0; color: #666; font-weight: 600; font-size: 0.8rem;">Propuesta</h6>
            {% for proyecto in estados.propuesta %}
                <div style="background: white; border-radius: 4px; padding: 0.5rem; margin-bottom: 0.25rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1); position: relative;">
                    <button onclick="openProyectoModal({{ proyecto.id }}, 'propuesta')" style="position: absolute; top: 2px; right: 2px; background: none; border: none; padding: 2px; cursor: pointer; opacity: 0.7;" title="Ver detalles">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                    <div style="font-weight: 500; margin-bottom: 0.1rem; font-size: 0.75rem; padding-right: 20px;">{{ proyecto.nombre }}</div>
                    <div style="font-size: 0.65rem; color: #666;">ID: {{ proyecto.id }} | ${{ "{:,.0f}".format(proyecto.monto) }}</div>
                </div>
            {% endfor %}
        </div>
        
        <div style="min-width: 150px; background: #f8f9fa; border-radius: 6px; padding: 0.75rem;">
            <h6 style="margin: 0 0 0.5rem 0; color: #666; font-weight: 600; font-size: 0.8rem;">Aprobación</h6>
            {% for proyecto in estados.aprobacion %}
                <div style="background: white; border-radius: 4px; padding: 0.5rem; margin-bottom: 0.25rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1); position: relative;">
                    <button onclick="openProyectoModal({{ proyecto.id }}, 'aprobado')" style="position: absolute; top: 2px; right: 2px; background: none; border: none; padding: 2px; cursor: pointer; opacity: 0.7;" title="Ver detalles">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                    <div style="font-weight: 500; margin-bottom: 0.1rem; font-size: 0.75rem; padding-right: 20px;">{{ proyecto.nombre }}</div>
                    <div style="font-size: 0.65rem; color: #666;">ID: {{ proyecto.id }} | ${{ "{:,.0f}".format(proyecto.monto) }}</div>
                </div>
            {% endfor %}
        </div>
        
        <div style="min-width: 150px; background: #f8f9fa; border-radius: 6px; padding: 0.75rem;">
            <h6 style="margin: 0 0 0.5rem 0; color: #666; font-weight: 600; font-size: 0.8rem;">En Desarrollo</h6>
            {% for proyecto in estados.desarrollo %}
                <div style="background: white; border-radius: 4px; padding: 0.5rem; margin-bottom: 0.25rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1); position: relative;">
                    <button onclick="openProyectoModal({{ proyecto.id }}, 'desarrollo')" style="position: absolute; top: 2px; right: 2px; background: none; border: none; padding: 2px; cursor: pointer; opacity: 0.7;" title="Ver detalles">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                    <div style="font-weight: 500; margin-bottom: 0.1rem; font-size: 0.75rem; padding-right: 20px;">{{ proyecto.nombre }}</div>
                    <div style="font-size: 0.65rem; color: #666;">ID: {{ proyecto.id }} | ${{ "{:,.0f}".format(proyecto.monto) }}</div>
                </div>
            {% endfor %}
        </div>
        
        <div style="min-width: 150px; background: #f8f9fa; border-radius: 6px; padding: 0.75rem;">
            <h6 style="margin: 0 0 0.5rem 0; color: #666; font-weight: 600; font-size: 0.8rem;">Testing</h6>
            {% for proyecto in estados.testing %}
                <div style="background: white; border-radius: 4px; padding: 0.5rem; margin-bottom: 0.25rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1); position: relative;">
                    <button onclick="openProyectoModal({{ proyecto.id }}, 'testing')" style="position: absolute; top: 2px; right: 2px; background: none; border: none; padding: 2px; cursor: pointer; opacity: 0.7;" title="Ver detalles">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                    <div style="font-weight: 500; margin-bottom: 0.1rem; font-size: 0.75rem; padding-right: 20px;">{{ proyecto.nombre }}</div>
                    <div style="font-size: 0.65rem; color: #666;">ID: {{ proyecto.id }} | ${{ "{:,.0f}".format(proyecto.monto) }}</div>
                </div>
            {% endfor %}
        </div>
        
        <div style="min-width: 150px; background: #f8f9fa; border-radius: 6px; padding: 0.75rem;">
            <h6 style="margin: 0 0 0.5rem 0; color: #666; font-weight: 600; font-size: 0.8rem;">Cierre</h6>
            {% for proyecto in estados.cierre %}
                <div style="background: white; border-radius: 4px; padding: 0.5rem; margin-bottom: 0.25rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1); position: relative;">
                    <button onclick="openProyectoModal({{ proyecto.id }}, 'cierre')" style="position: absolute; top: 2px; right: 2px; background: none; border: none; padding: 2px; cursor: pointer; opacity: 0.7;" title="Ver detalles">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                    <div style="font-weight: 500; margin-bottom: 0.1rem; font-size: 0.75rem; padding-right: 20px;">{{ proyecto.nombre }}</div>
                    <div style="font-size: 0.65rem; color: #666;">ID: {{ proyecto.id }} | ${{ "{:,.0f}".format(proyecto.monto) }}</div>
                </div>
            {% endfor %}
        </div>
        
        <div style="min-width: 150px; background: #f8f9fa; border-radius: 6px; padding: 0.75rem;">
            <h6 style="margin: 0 0 0.5rem 0; color: #666; font-weight: 600; font-size: 0.8rem;">Evaluación</h6>
            {% for proyecto in estados.evaluacion %}
                <div style="background: white; border-radius: 4px; padding: 0.5rem; margin-bottom: 0.25rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1); position: relative;">
                    <button onclick="openProyectoModal({{ proyecto.id }}, 'evaluacion')" style="position: absolute; top: 2px; right: 2px; background: none; border: none; padding: 2px; cursor: pointer; opacity: 0.7;" title="Ver detalles">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                    <div style="font-weight: 500; margin-bottom: 0.1rem; font-size: 0.75rem; padding-right: 20px;">{{ proyecto.nombre }}</div>
                    <div style="font-size: 0.65rem; color: #666;">ID: {{ proyecto.id }} | ${{ "{:,.0f}".format(proyecto.monto) }}</div>
                </div>
            {% endfor %}
        </div>
        
        <div style="min-width: 150px; background: #f8f9fa; border-radius: 6px; padding: 0.75rem;">
            <h6 style="margin: 0 0 0.5rem 0; color: #666; font-weight: 600; font-size: 0.8rem;">Finalizados</h6>
            {% for proyecto in estados.finalizados %}
                <div style="background: white; border-radius: 4px; padding: 0.5rem; margin-bottom: 0.25rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1); position: relative;">
                    <button onclick="openProyectoModal({{ proyecto.id }}, 'finalizado')" style="position: absolute; top: 2px; right: 2px; background: none; border: none; padding: 2px; cursor: pointer; opacity: 0.7;" title="Ver detalles">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                    </button>
                    <div style="font-weight: 500; margin-bottom: 0.1rem; font-size: 0.75rem; padding-right: 20px;">{{ proyecto.nombre }}</div>
                    <div style="font-size: 0.65rem; color: #666;">ID: {{ proyecto.id }} | ${{ "{:,.0f}".format(proyecto.monto) }}</div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Modal de Nueva Oportunidad -->
<div id="nuevaOportunidadModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 9999;">
    <div class="modal-dialog" style="max-width: 600px; width: 90%; margin: 1.75rem auto;">
        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); overflow: hidden;">
            <div class="modal-header" style="background: #8B5A9D; border-bottom: none; padding: 1.25rem 1.5rem; position: relative;">
                <h5 class="modal-title" style="font-size: 1.125rem; font-weight: 600; color: white; margin: 0;">Nueva Oportunidad</h5>
                <button type="button" class="btn-close-custom" onclick="closeOportunidadModal()" style="background: none; border: none; color: white; font-size: 1.5rem; opacity: 1; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; position: absolute; right: 1.5rem; top: 50%; transform: translateY(-50%);">×</button>
            </div>
            <div class="modal-body" style="background: white; color: #333; padding: 1.5rem; max-height: 70vh; overflow-y: auto;">
                <div style="display: flex; align-items: center; margin-bottom: 1rem; color: #8B5A9D; font-size: 0.875rem; cursor: pointer;" onclick="closeOportunidadModal()">
                    <span style="margin-right: 0.5rem;">←</span>
                    <span>Volver</span>
                </div>
                
                <form id="nuevaOportunidadForm">
                    <div class="form-group" style="margin-bottom: 1.25rem;">
                        <label for="cuenta" class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Cuenta</label>
                        <select class="form-control" id="cuenta" name="cuenta" required style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%; background-color: #f8f9fa;">
                            <option value="">Seleccionar cuenta...</option>
                            <option value="cliente_1">Banco Nacional S.A.</option>
                            <option value="cliente_2">Corporación Minera del Norte</option>
                            <option value="cliente_3">Industrias Alimentarias del Sur</option>
                            <option value="cliente_4">Telecomunicaciones Globales</option>
                            <option value="cliente_5">Energía Renovable Colombia</option>
                            <option value="cliente_6">Retail Fashion Group</option>
                            <option value="cliente_7">Farmaceutica Nacional</option>
                            <option value="cliente_8">Constructora Metropolitan</option>
                            <option value="cliente_9">Seguros y Fianzas del Pacífico</option>
                            <option value="cliente_10">Universidad Tecnológica Nacional</option>
                        </select>
                    </div>

                    <div class="form-group" style="margin-bottom: 1.25rem;">
                        <label for="nombre" class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">
                            Caso de uso 
                            <span style="color: #666; font-size: 0.8rem; margin-left: 0.5rem;" title="Nombre (Business problem)">💬 Nombre (Business problem)</span>
                        </label>
                        <input type="text" class="form-control" id="nombre" name="nombre" placeholder="Ingrese el nombre del caso de uso..." style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;">
                    </div>

                    <div class="form-group" style="margin-bottom: 1.25rem;">
                        <label for="descripcion" class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">
                            Descripción 
                            <span style="color: #666; font-size: 0.8rem; margin-left: 0.5rem;" title="Iniciativa analítica">💬 Iniciativa analítica</span>
                        </label>
                        <textarea class="form-control" id="descripcion" name="descripcion" rows="3" placeholder="Describa la iniciativa analítica..." style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%; resize: vertical;"></textarea>
                    </div>

                    <div class="form-group" style="margin-bottom: 1.5rem;">
                        <label for="impacto" class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">
                            Impacto 
                            <span style="color: #666; font-size: 0.8rem; margin-left: 0.5rem;" title="Impacto de negocio esperado (decisiones)">💬 Impacto de negocio esperado (decisiones)</span>
                        </label>
                        <textarea class="form-control" id="impacto" name="impacto" rows="3" placeholder="Describa el impacto esperado en el negocio..." style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%; resize: vertical;"></textarea>
                    </div>

                    <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 1rem; padding-top: 1rem; border-top: 1px solid #eee;">
                        <button type="button" onclick="closeOportunidadModal()" style="background: #f8f9fa; color: #666; border: 1px solid #ddd; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 500; cursor: pointer;">Cancelar</button>
                        <button type="submit" style="background: #8B5A9D; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 500; cursor: pointer;">Crear Oportunidad</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalles del Proyecto -->
<div id="proyectoDetallesModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 9999;">
    <div class="modal-dialog" style="max-width: 800px; width: 90%; margin: 1.75rem auto;">
        <div class="modal-content" style="border: none; border-radius: 12px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); overflow: hidden; max-height: 90vh;">
            <div class="modal-header" style="background: #8B5A9D; border-bottom: none; padding: 1.25rem 1.5rem; position: relative;">
                <h5 class="modal-title" style="font-size: 1.125rem; font-weight: 600; color: white; margin: 0;">Detalles del Proyecto</h5>
                <button type="button" class="btn-close-custom" onclick="closeProyectoModal()" style="background: none; border: none; color: white; font-size: 1.5rem; opacity: 1; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; cursor: pointer; position: absolute; right: 1.5rem; top: 50%; transform: translateY(-50%);">×</button>
            </div>
            <div class="modal-body" style="background: white; color: #333; padding: 1.5rem; max-height: 70vh; overflow-y: auto;">
                <form id="proyectoDetallesForm">
                    <div class="row">
                        <!-- Columna izquierda -->
                        <div class="col-md-6">
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">ID del Caso</label>
                                <input type="text" id="proyecto_id" readonly style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%; background-color: #f8f9fa;">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Cuenta</label>
                                <input type="text" id="proyecto_cuenta" readonly style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%; background-color: #f8f9fa;">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Caso de Uso</label>
                                <input type="text" id="proyecto_caso_uso" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;" placeholder="Sin datos">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Descripción</label>
                                <textarea id="proyecto_descripcion" rows="3" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%; resize: vertical;" placeholder="Sin datos"></textarea>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Impacto</label>
                                <textarea id="proyecto_impacto" rows="3" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%; resize: vertical;" placeholder="Sin datos"></textarea>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Puntuación Impacto</label>
                                <input type="number" id="proyecto_puntuacion_impacto" min="1" max="10" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;" placeholder="Sin datos">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Puntuación Técnica</label>
                                <input type="number" id="proyecto_puntuacion_tecnica" min="1" max="10" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;" placeholder="Sin datos">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Palabras Clave</label>
                                <input type="text" id="proyecto_palabras_clave" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;" placeholder="Sin datos">
                            </div>
                        </div>
                        
                        <!-- Columna derecha -->
                        <div class="col-md-6">
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Estado</label>
                                <input type="text" id="proyecto_estado" readonly style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%; background-color: #f8f9fa;">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Producto</label>
                                <select id="proyecto_producto" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;">
                                    <option value="">Sin datos</option>
                                    <option value="analytics">Analytics</option>
                                    <option value="ia">Inteligencia Artificial</option>
                                    <option value="desarrollo">Desarrollo de Software</option>
                                    <option value="consultoria">Consultoría</option>
                                    <option value="automatizacion">Automatización</option>
                                </select>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Fecha Inicio</label>
                                <input type="date" id="proyecto_fecha_inicio" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Fecha Cierre</label>
                                <input type="date" id="proyecto_fecha_cierre" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Monto Venta</label>
                                <input type="number" id="proyecto_monto_venta" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;" placeholder="Sin datos">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Costos Proyecto</label>
                                <input type="number" id="proyecto_costos_proyecto" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;" placeholder="Sin datos">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Margen Estimado %</label>
                                <input type="number" id="proyecto_margen_estimado_porcentaje" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;" placeholder="Sin datos">
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 1rem;">
                                <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Margen Estimado Bruto</label>
                                <input type="number" id="proyecto_margen_estimado_bruto" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%;" placeholder="Sin datos">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-bottom: 1.5rem;">
                        <label class="form-label" style="font-weight: 500; color: #555; margin-bottom: 0.5rem;">Feedback</label>
                        <textarea id="proyecto_feedback" rows="3" style="border: 1px solid #ddd; border-radius: 8px; padding: 0.75rem; font-size: 0.95rem; width: 100%; resize: vertical;" placeholder="Sin datos"></textarea>
                    </div>
                    
                    <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 1rem; padding-top: 1rem; border-top: 1px solid #eee;">
                        <button type="button" onclick="closeProyectoModal()" style="background: #f8f9fa; color: #666; border: 1px solid #ddd; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 500; cursor: pointer;">Cerrar</button>
                        <button type="submit" id="guardarCambiosBtn" style="background: #8B5A9D; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 500; cursor: pointer; display: none;">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Datos de proyectos desde el backend
const proyectosData = {
    {% for proyecto in (estados.oportunidad + estados.propuesta + estados.aprobacion + estados.desarrollo + estados.testing + estados.cierre + estados.evaluacion + estados.finalizados) %}
    {{ proyecto.id }}: { 
        nombre: "{{ proyecto.nombre }}", 
        cuenta: "{{ proyecto.aliado_id }}", 
        estado: "{{ proyecto.etapa }}",
        monto: {{ proyecto.monto }},
        fecha_inicio: "{{ proyecto.fecha_inicio }}",
        fecha_fin: "{{ proyecto.fecha_fin }}",
        consultores: {{ proyecto.consultores_asignados }}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
};

function openProyectoModal(proyectoId, estado) {
    const proyecto = proyectosData[proyectoId];
    if (!proyecto) return;
    
    // Llenar campos no editables
    document.getElementById('proyecto_id').value = proyectoId;
    document.getElementById('proyecto_cuenta').value = proyecto.cuenta;
    document.getElementById('proyecto_estado').value = estado.charAt(0).toUpperCase() + estado.slice(1);
    
    // Llenar campos editables con datos simulados o vacíos
    document.getElementById('proyecto_caso_uso').value = proyecto.nombre;
    document.getElementById('proyecto_descripcion').value = "";
    document.getElementById('proyecto_impacto').value = "";
    document.getElementById('proyecto_puntuacion_impacto').value = "";
    document.getElementById('proyecto_puntuacion_tecnica').value = "";
    document.getElementById('proyecto_palabras_clave').value = "";
    document.getElementById('proyecto_producto').value = "";
    document.getElementById('proyecto_fecha_inicio').value = proyecto.fecha_inicio || "";
    document.getElementById('proyecto_fecha_cierre').value = proyecto.fecha_fin || "";
    document.getElementById('proyecto_monto_venta').value = proyecto.monto || "";
    document.getElementById('proyecto_costos_proyecto').value = "";
    document.getElementById('proyecto_margen_estimado_porcentaje').value = "";
    document.getElementById('proyecto_margen_estimado_bruto').value = "";
    document.getElementById('proyecto_feedback').value = "";
    
    // Determinar si el proyecto es editable
    const esEditable = estado === 'oportunidad' || estado === 'propuesta';
    const guardarBtn = document.getElementById('guardarCambiosBtn');
    
    // Configurar editabilidad de campos
    const camposEditables = [
        'proyecto_caso_uso', 'proyecto_descripcion', 'proyecto_impacto',
        'proyecto_puntuacion_impacto', 'proyecto_puntuacion_tecnica', 'proyecto_palabras_clave',
        'proyecto_producto', 'proyecto_fecha_inicio', 'proyecto_fecha_cierre',
        'proyecto_monto_venta', 'proyecto_costos_proyecto', 'proyecto_margen_estimado_porcentaje',
        'proyecto_margen_estimado_bruto', 'proyecto_feedback'
    ];
    
    camposEditables.forEach(campo => {
        const elemento = document.getElementById(campo);
        elemento.readOnly = !esEditable;
        elemento.disabled = !esEditable;
        elemento.style.backgroundColor = esEditable ? '#fff' : '#f8f9fa';
    });
    
    // Mostrar/ocultar botón de guardar
    guardarBtn.style.display = esEditable ? 'inline-block' : 'none';
    
    // Mostrar modal
    document.getElementById('proyectoDetallesModal').style.display = 'block';
}

function closeProyectoModal() {
    document.getElementById('proyectoDetallesModal').style.display = 'none';
}

function openOportunidadModal() {
    const modal = document.getElementById('nuevaOportunidadModal');
    if (modal) {
        modal.style.display = 'block';
    }
}

function closeOportunidadModal() {
    const modal = document.getElementById('nuevaOportunidadModal');
    if (modal) {
        modal.style.display = 'none';
        const form = document.getElementById('nuevaOportunidadForm');
        if (form) {
            form.reset();
        }
    }
}

// Event listeners cuando el DOM esté cargado
document.addEventListener('DOMContentLoaded', function() {
    // Cerrar modales al hacer click fuera
    const nuevaOportunidadModal = document.getElementById('nuevaOportunidadModal');
    if (nuevaOportunidadModal) {
        nuevaOportunidadModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeOportunidadModal();
            }
        });
    }
    
    const proyectoDetallesModal = document.getElementById('proyectoDetallesModal');
    if (proyectoDetallesModal) {
        proyectoDetallesModal.addEventListener('click', function(e) {
            if (e.target === this) {
                closeProyectoModal();
            }
        });
    }
});
</script>
{% endblock %}